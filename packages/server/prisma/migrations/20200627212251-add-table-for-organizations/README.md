# Migration `20200627212251-add-table-for-organizations`

This migration has been generated by zuice at 6/27/2020, 9:22:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Organization" (
"domain" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"ownerId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_OrganizationToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Link" ADD COLUMN "organizationId" text   ;

CREATE UNIQUE INDEX "Organization.name" ON "public"."Organization"("name")

CREATE UNIQUE INDEX "Organization.domain" ON "public"."Organization"("domain")

CREATE UNIQUE INDEX "_OrganizationToUser_AB_unique" ON "public"."_OrganizationToUser"("A","B")

CREATE  INDEX "_OrganizationToUser_B_index" ON "public"."_OrganizationToUser"("B")

ALTER TABLE "public"."Organization" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_OrganizationToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Organization"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_OrganizationToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Link" ADD FOREIGN KEY ("organizationId")REFERENCES "public"."Organization"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200626022739-make-link-slugs-unique..20200627212251-add-table-for-organizations
--- datamodel.dml
+++ datamodel.dml
@@ -2,28 +2,42 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id           String  @id @default(uuid())
-  name         String
-  password     String
-  email        String  @unique
-  tokenVersion Int     @default(1)
-  stripeId     String? @unique
-  links        Link[]
+  id                  String         @id @default(uuid())
+  name                String
+  password            String
+  email               String         @unique
+  tokenVersion        Int            @default(1)
+  stripeId            String?        @unique
+  links               Link[]
+  ownedOrganizations  Organization[] @relation("owner")
+  partOfOrganizations Organization[] @relation(references: [id])
 }
+model Organization {
+  id      String @id @default(uuid())
+  name    String @unique
+  domain  String @unique
+  ownerId String
+  owner   User   @relation(name: "owner", fields: [ownerId], references: [id])
+  members User[] @relation(references: [id])
+  links   Link[]
+}
+
 model Link {
-  id     String @id @default(uuid())
-  slug   String @unique
-  url    String
-  userId String
-  user   User   @relation(fields: [userId], references: [id])
+  id             String        @id @default(uuid())
+  slug           String        @unique
+  url            String
+  userId         String
+  organizationId String?
+  user           User          @relation(fields: [userId], references: [id])
+  organization   Organization? @relation(fields: [organizationId], references: [id])
 }
```


